{
  "3rd/image.nvim",
  opts = {
    backend = "kitty",
    -- This prevents the crash in headless mode
    setup_gui = false, 
    -- ... your other opts
  },
  config = function(_, opts)
    -- Only load if we are not in headless mode
    if #vim.api.nvim_list_uis() > 0 then
      require("image").setup(opts)
    end
  end
}
